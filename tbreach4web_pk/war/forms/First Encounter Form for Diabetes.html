<!-- Copyright(C) 2015 Interactive Health Solutions, Pvt. Ltd.

This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as
published by the Free Software Foundation; either version 3 of the License (GPLv3), or any later version.
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with this program; if not, write to the Interactive Health Solutions, info@ihsinformatics.com
You can also access the license on the internet at the address: http://www.gnu.org/licenses/gpl-3.0.html

Interactive Health Solutions, hereby disclaims all copyright interest in this program written by the contributors.

Contributors: Tahira Niazi -->
<htmlform>
	<br/>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>
	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>First Encounter Form for Diabetes (v1.0)</h2>
	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Form Date:</td>
				<td>
					<encounterDate default="today"/>
				</td>
			</tr>
			<tr>
				<td>Location:</td>
				<td>
					<encounterLocation default="1"/>
				</td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td>
					<encounterProvider default="currentUser"/>
				</td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Patient Information">
		<div>
			<p>
				Age: <lookup expression="patient.age"/>
			</p>
			<p>
				Address: <lookup expression="patient.personAddress.address1" />, <lookup expression="patient.personAddress.cityVillage" />, <lookup expression="patient.personAddress.country" />
			</p>
			<p>
				Contact(s): <lookup expression="personAttributes.get('Primary Mobile')"/>
			</p>
		</div>
	</section>

	<section headerLabel="3. Test Results">
		<div>
			<p>
				<lookup expression="fn.getConcept('139').description"/>:<b><lookup expression="fn.latestObs(139).value"/></b>
			</p>
			<p>
				<lookup expression="fn.getConcept('168').description"/>:<b><lookup expression="fn.latestObs(168).value"/></b>
			</p>
			<p>
				<lookup expression="fn.getConcept('114').description"/>:<b><lookup expression="fn.latestObs(114).valueCoded.name"/></b>
			</p>
		</div>
	</section>
	
	<section headerLabel="4. Treatment">
		<div>
			<p>
				<lookup expression="fn.getConcept('285').description"/><br/>
				<obs conceptId="285" id="treatment_enrollment" answerConceptIds="1,2" defaultValue="1" style="radio"/>				
			</p>
			<div id="treatment_div">
				<p>
					Current Weight (kg): <lookup expression="fn.latestObs(22).valueNumeric"/>
				</p>
				<p>
					<lookup expression="fn.getConcept('22').description"/><br/>
					<obs conceptId="22" id="weight" size="3"/>
				</p>
				<div id="female_div">
					<p>
						<lookup expression="fn.getConcept('286').description"/><br/>
						<obs conceptId="286" id="pregnant" defaultValue="2"/>
					</p>
					<p>
						<lookup expression="fn.getConcept('287').description"/><br/>
						<obs conceptId="287" id="breastfeeding" defaultValue="2"/>
					</p>
				</div>
				<p>
					<lookup expression="fn.getConcept('288').description"/><br/>
					<obs conceptId="288" id="renal_disease" defaultValue="2"/>
				</p>
				<p>
					<lookup expression="fn.getConcept('289').description"/><br/>
					<obs conceptId="289" id="liver_disease" defaultValue="2"/>
				</p>
				<p>
					<lookup expression="fn.getConcept('118').description"/><br/>
					<obs conceptId="118" id="diabetes_medication_history" defaultValue="2"/>
				</p>
				<div id="medicine_div">
					<p>
						<lookup expression="fn.getConcept('387').description"/><br/>
						<obs conceptId="387" id="diabetes_medicine" defaultValue="2"/>
					</p>
				</div>
				<div id="contraindication_div">
					<p>
						<lookup expression="fn.getConcept('328').description"/><br/>
						<obs conceptId="328" id="regimen_contraindication" defaultValue="2"/>
					</p>
				</div>
				<div id="regimen_serial_div">
					<p>
						<lookup expression="fn.getConcept('356').description"/><br/>
						<obs conceptId="356" id="regimen_serial"/>
					</p>
				</div>
				<p>
					<lookup expression="fn.getConcept('320').description"/><br/>
					<obs conceptId="320" id="treatment_centre" defaultValue="317"/>
				</p>
				<p>
					<lookup expression="fn.getConcept('322').description"/><br/>
					<obs conceptId="322" id="drug_site" defaultValue="321"/>
				</p>
			</div>
		</div>
	</section>
	<submit/>
	
	<script type="text/javascript">
		if(jQuery) {
		$j(document).ready(function() {
			// If gender is male, then hide Pregnancy and Breastfeeding questions
			var gender = "<lookup expression="patient.gender"/>";
			var femaleDiv = $j("#female_div");
			if (gender == "M") {
				femaleDiv.hide();
			}
			$j("#treatment_enrollment").change(function() {
				var treatmentDiv = $j("#treatment_div");
				var txEnrollmentValue = getValue('treatment_enrollment.value');
				if (txEnrollmentValue == 1) {
					treatmentDiv.show();
				}
				else {
					treatmentDiv.hide();
				}
				setContraindication();
			});
			$j("#treatment_enrollment").change();
			$j("#diabetes_medication_history").change(function() {
				var medicineDiv = $j("#medicine_div");
				var medicationHistoryValue = getValue('diabetes_medication_history.value');
				if (medicationHistoryValue == 1) {
					medicineDiv.show();
				}
				else {
					medicineDiv.hide();
				}
			});
			$j("#diabetes_medication_history").change();
			$j("#diabetes_medicine").change(function() {
				setContraindication();
			});
			$j("#diabetes_medication_history").change();
			$j("#regimen_contraindication").change(function() {
				var regimenSerialDiv = $j("#regimen_serial_div");
				var contraindicationValue = getValue('regimen_contraindication.value');
				if (contraindicationValue == 1) {
					regimenSerialDiv.hide();
				}
				else {
					regimenSerialDiv.show();
				}
			});
			$j("#regimen_contraindication").change();
		});
	}
	function setContraindication() {
		var age = "<lookup expression="patient.age"/>";
		var bloodSugar = "<lookup complexExpression="$fn.latestObs(139).valueCoded"/>";
		var hbA1c = "<lookup complexExpression="$fn.latestObs(168).valueCoded"/>";
		var pregnantValue = getValue('pragnent.value');
		var breastfeedingValue = getValue('breastfeeding.value');
		var medicationValue = getValue('diabetes_medication_history.value');
		if (age > 80 || bloodSugar > 350 || hbA1c > 10 || pregnantValue == 1 || breastfeedingValue == 1 || medicationValue == 1) {
			setValue('regimen_contraindication.value', 1);
		}
	}
	</script>
</htmlform>
