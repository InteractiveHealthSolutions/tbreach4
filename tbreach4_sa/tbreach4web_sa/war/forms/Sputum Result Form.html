<htmlform>
	<!-- Autogenerated example form  (template from 01-Nov-2010 -->
	<macros>
		paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>

	<style>
		.section {
			border: 1px solid $headerColor;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: $headerColor;
			color: $fontOnHeaderColor;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>Sputum Result Form (v1.0)</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date result received from sputum collection point:</td>
				<td><encounterDate default="today"/></td>
			</tr>
			<tr>
				<td>Location:</td>
				<td><encounterLocation/></td>
			</tr>
			<tr>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" /></td>
			</tr>
		</table>
	</section>

	<section headerLabel="2. Sputum Result">
		 <p>
			<lookup expression="fn.getConcept('67').description"/><br/>
			<obs conceptId="67" id="nhls_id"/>
		</p>
                 <p>
                        <lookup expression="fn.getConcept('68').description"/><br/>
			<obs conceptId="68" id="date_test_result"/>
                 </p>
                 <p>
                        <lookup expression="fn.getConcept('69').description"/><br/>
			<obs conceptId="69" id="lab_accept" defaultValue="1"/>
                 </p>
                 <div id="rejection_reason_div">
                 <p>
                        <lookup expression="fn.getConcept('66').description"/><br/>
			<obs conceptId="66" id="rejection_reason" defaultValue="62"/>
                 </p>
                 </div>
                 <div id="gxp_result_div">
                 <p>
                        <lookup expression="fn.getConcept('75').description"/><br/>
			<obs conceptId="75" id="gxp_result" defaultValue="70"/>
                 </p>
                 <div id="gxp_postive_div">
                 <p>
                        <lookup expression="fn.getConcept('79').description"/><br/>
			<obs conceptId="79" id="rif_result" defaultValue="76"/>
                 </p>
                  <p>
                        <lookup expression="fn.getConcept('84').description"/><br/>
			<obs conceptId="84" id="mtb_burden" defaultValue="80"/>
                 </p>
                 </div>
                 <div id="error_div">
                 <p>
                        <lookup expression="fn.getConcept('85').description"/><br/>
			<obs conceptId="85" id="error_code"/>
                 </p>
                 </div>
                 </div>
	</section>
	<submit/>

         <script type="text/javascript">
		if(jQuery) {
                       $j("#lab_accept").change(function() {
                                
                                var rejectionReasonDiv = $j("#rejection_reason_div");
                                var labTestIdDiv = $j("#gxp_result_div");
				var value = getValue('lab_accept.value');
				if (value == 2) {
					rejectionReasonDiv .show();
                                        labTestIdDiv.hide();
                                        }
				else {
                                        if (value == 1) {
					    labTestIdDiv.show();
                                            rejectionReasonDiv .hide();
                                        }
                                      labTestIdDiv.show();
                                      rejectionReasonDiv .hide();
				}
			});
			$j("#lab_accept").change();
                        $j("#gxp_result").change(function() {
                                var gxpPositiveDiv = $j("#gxp_postive_div");	
                                var errorDiv = $j("#error_div");
                                var value = getValue('gxp_result.value');
                                if(value == 71){
                                      gxpPositiveDiv.show();
                                      errorDiv.hide();
                                }
                                else if(value == 72){
                                      gxpPositiveDiv.hide();
                                      errorDiv.show();
                                }
                                else{
                                      gxpPositiveDiv.hide();
                                      errorDiv.hide();
                                }
			});
			$j("#gxp_result").change();
                        
                }

                <!-- Error Checking before Form Submit -->
		beforeSubmit.push(function() {
			// Validate lab test code
			var valid = true;
			var error = '';

                        
                           var testId= getValue('nhls_id.value');
                           if (testId.length != 11) {
                                valid = false;
				error = error + "Lab Test Code is invalid or empty. Please check that you have entered correct lab test code.\n";
			   }
                          else{
                                var testIds = "<lookup complexExpression="#foreach($id in $fn.allObs(67)) $id.valueText #end"/>";
                                if(testIds.indexOf(testId) > -1){
                                      valid = false;
				      error = error + "Lab test code is invalid or does not exist. Please check that you have entered correct lab test code.\n";
                                  }
                          }
                       
                           var value = getValue('gxp_result.value');
                           if(value ==72){
                                 var errorCode= getValue('error_code.value');
                                 if (errorCode.length != 4) {
                                     valid = false;
				     error = error + "Error Code is invalid or empty. Please check that you have entered correct Error code.\n";
			        }
                           }  
      
			if (!valid) {
				alert (error);
			}
	        return valid;
		});
	</script>
</htmlform>